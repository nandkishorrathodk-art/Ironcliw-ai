title = "Ironcliw Secret Scanner Configuration"

[extend]
# Use default gitleaks rules
useDefault = true

# Custom rules for Ironcliw-specific secrets
[[rules]]
id = "anthropic-api-key"
description = "Anthropic API Key"
regex = '''sk-ant-api03-[a-zA-Z0-9_-]{95}'''
tags = ["key", "anthropic"]

[[rules]]
id = "anthropic-api-key-partial"
description = "Partial Anthropic API Key"
regex = '''sk-ant-api03-[a-zA-Z0-9_-]{10,}'''
tags = ["key", "anthropic", "partial"]

[[rules]]
id = "picovoice-key"
description = "Picovoice Access Key"
regex = '''[a-zA-Z0-9+/]{40,}=='''
tags = ["key", "picovoice"]

[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey|access[_-]?key)["\s:=]+[a-zA-Z0-9_-]{20,}'''
tags = ["key", "generic"]

[[rules]]
id = "password-assignment"
description = "Password assignment in code/docs"
regex = '''(?i)(password|passwd|pwd)["\s:=]+[^"\s]{8,}'''
tags = ["password"]

[[rules]]
id = "database-password"
description = "Database connection string with password"
regex = '''(?i)password["\s:=]+JarvisSecure[a-zA-Z0-9!@#$%^&*]+'''
tags = ["password", "database"]

[[rules]]
id = "gcp-service-account-key"
description = "GCP Service Account Key"
regex = '''"type":\s*"service_account"'''
tags = ["gcp", "service-account"]

# Allowlist - patterns that are safe to ignore
[allowlist]
description = "Allowlist for safe patterns and example files"

# Safe placeholder patterns
regexes = [
  '''YOUR_.*_HERE''',
  '''your-.*-here''',
  '''example\.com''',
  '''\*\*\*REMOVED\*\*\*''',
  '''<YOUR_.*>''',
  '''placeholder''',
  '''XXXXXXXX''',
  '''sk-ant-api03-YOUR''',
  # Allow reference to secret manager retrieval
  '''get_secret\(".*"\)''',
  '''SecretManager''',
  '''get_db_password''',
  '''get_anthropic_key''',
  '''get_picovoice_key''',
  # Allow documentation about secret patterns
  '''regex\s*=''',
  '''pattern\s*=''',
  # Allow function names with password
  '''import.*password''',
  '''def.*password''',
  # Allow environment variable references
  '''Ironcliw_DB_PASSWORD''',
  '''os\.getenv.*PASSWORD''',
  # Allow password variables that retrieve from Secret Manager (SAFE)
  '''db_password\s*=\s*get_secret''',
  '''db_password\s*=\s*get_db_password''',
  '''password\s*=\s*db_password''',
  '''password=db_password''',
  '''db_password = get_db_password\(\)''',
  # Allow password from config getter (not hardcoded)
  '''password=self\.config\[''',
  '''password=self\.cloudsql_config\.get\("password"\)''',
  '''password.*=.*self\.cloudsql_config\.get''',
  '''\[1;3;mpassword\[0m.*=.*self\.cloudsql_config\.get''',
  '''\.get\('password',''',
  '''\.get\("password"\)''',
  # Allow keychain password checks (not exposing actual passwords)
  '''has_password\s*=''',
  '''if not has_password''',
  '''Keychain password''',
  '''password.*retrieved.*keychain''',
  '''Password.*retrieved.*keychain''',
  '''password retrieval''',
  '''Password retrieval''',
  '''#.*PASSWORD.*RETRIEVAL''',
  '''keychain.*password.*management''',
  # Allow password in docstrings and log messages
  '''Type password characters''',
  '''type password characters''',
  '''Failed to type password''',
  # Allow password mentions in documentation (often with ANSI color codes)
  '''(?i)\[1;3;m[pP]assword\[0m''',
  '''(?i)password.*retrieved from keychain''',
  '''(?i)secure.*password''',
  '''(?i)memory-safe.*password''',
  '''(?i)password.*retrieval''',
  '''(?i)test.*password''',
  # Allow password as enum value or authentication method name (not actual password values)
  '''PASSWORD\s*=\s*auto\(\)''',
  '''self\.PASSWORD:\s*"Password"''',
  '''PASSWORD.*fallback''',
  '''Password fallback''',
  '''Final: Password fallback''',
  '''Step.*: Password fallback''',
  '''AuthenticationDecision\.PASSWORD''',
  '''AuthenticationMethod\.PASSWORD''',
  # Allow password in authentication method enums and fallback descriptions
  '''(?i)password.*authentication''',
  '''(?i)password.*method''',
  '''(?i)password.*as.*fallback''',
  '''(?i)password.*to.*unlock''',
  # Connection manager - safe password variable passing (from Secret Manager)
  '''password\s*:\s*Optional\[str\]\s*=\s*None''',
  '''password:\s*Database\s*password''',
  '''password=password,''',
  '''if\s+not\s+password:''',
  '''password\s*=\s*get_db_password\(\)''',
  # Allow password typing metrics in monitoring (no actual password values)
  '''characters in password''',
  '''typing password''',
  '''password_typed''',
  '''password_success''',
  '''password_length_ms''',
  '''password_type_ms''',
  # Allow password variable from keychain retrieval (not exposing secrets)
  '''password\s*=\s*result\.stdout\.strip\(\)''',
  '''password\s*=\s*stdout\.decode\(\)\.strip\(\)''',
  '''if not password:''',
  '''if password:''',
  '''# Clear password variable''',
  '''password=password,''',
  '''password\s*=\s*password,''',
  '''password=config\.db_password,''',
  # ML Architecture and metrics (documentation, no actual secrets)
  '''Position in password''',
  '''### \*\*Password Typing''',
  '''\*\*Password Typing\*\*:''',
  '''typing my password''',
  '''password correctly''',
  '''Password Typing Optimization''',
  # Allow user-facing authentication fallback messages (no actual secrets)
  '''(?i)use password authentication''',
  '''(?i)use your password''',
  '''(?i)using your password''',
  '''(?i)try using your password''',
  '''(?i)use password\.''',
  '''(?i)password authentication\.''',
  '''(?i)Please use password''',
  '''(?i)Please try using''',
  '''(?i)password instead''',
  '''(?i)use.*password instead''',
  '''(?i)using.*password instead''',
  # App names that contain "Password" (e.g., 1Password password manager)
  '''"1Password"''',
  '''1Password''',
  # Comments describing notification categories (not actual secrets)
  '''Password prompts''',
  '''auth requests''',
]

# Safe paths - files that are allowed to contain example secrets
paths = [
  '''.env.example''',
  '''backend/.env.example''',
  '''frontend/.env.example''',
  '''backend/voice/.env.example''',
  '''SECURITY_CLEANUP_PLAN.md''',
  '''LONG_TERM_SECRET_MANAGEMENT.md''',
  '''SECRET_MANAGEMENT_IMPLEMENTATION.md''',
  '''SECRET_MIGRATION_COMPLETE.md''',
  '''CLOUD_SQL_PROXY_SETUP.md''',
  '''VOICE_UNLOCK_OPTIMIZATION.md''',
  '''SCREEN_UNLOCK_FIX_COMPLETE.md''',
  '''SYSTEM_FIXES_SUMMARY.md''',
  '''VOICE_UNLOCK_STATUS_SUMMARY.md''',
  '''DYNAMIC_VOICE_UNLOCK_IMPLEMENTATION.md''',
  '''VOICE_BIOMETRIC_INTELLIGENCE_ARCHITECTURE.md''',
  '''.gitleaks.toml''',
  '''README.md''',
  '''diagnose_unlock.py''',
  '''run_unlock_test.sh''',
  '''update_unlock_password.py''',
  '''backend/fix_unlock_password.py''',
  '''test_password_typing.py''',
  # Secret manager code
  '''backend/core/secret_manager.py''',
  '''backend/scripts/setup_local_secrets.py''',
  # Database sync code (uses Secret Manager for passwords)
  '''backend/intelligence/hybrid_database_sync.py''',
  '''backend/intelligence/cloud_database_adapter.py''',
  '''backend/intelligence/cloud_sql_proxy_manager.py''',
  '''backend/chatbots/claude_chatbot.py''',
  '''backend/voice/profile_consolidation_service.py''',
  '''backend/system_control/macos_controller.py''',
  '''backend/voice_unlock/secure_password_typer.py''',
  '''backend/voice_unlock/voice_unlock_monitor.py''',
  '''backend/api/simple_unlock_handler.py''',
  '''backend/voice_unlock/intelligent_voice_unlock_service.py''',
  '''backend/voice_unlock/voice_unlock_integration.py''',
  '''backend/voice_unlock/voice_biometric_intelligence.py''',
  '''backend/voice_unlock/fix_keychain_password.sh''',
  '''backend/voice_unlock/metrics_database.py''',
  '''backend/voice_unlock/orchestration/voice_auth_orchestrator.py''',
  # Keychain management (retrieves passwords from keychain, doesn't store hardcoded secrets)
  '''backend/macos_keychain_unlock.py''',
  '''backend/voice_unlock/ML_ARCHITECTURE.md''',
  '''backend/voice_unlock/continuous_learning_engine.py''',
  '''test_voice_biometric_unlock_e2e.py''',
  '''start_system.py''',
  # Database test scripts (use Secret Manager, no hardcoded secrets)
  '''check_db_schema.py''',
  '''check_schema.py''',
  '''check_voice_samples.py''',
  '''test_voice_retrieval.py''',
  '''test_voice_with_real_audio.py''',
  '''test_asyncpg.py''',
  '''test_voice_unlock_confidence.py''',
  # Connection management (uses Secret Manager, no hardcoded secrets)
  '''test_connection_manager.py''',
  '''test_voice_cache.py''',
  '''diagnose_connections.py''',
  '''backend/intelligence/cloud_sql_connection_manager.py''',
  '''backend/core/lifecycle_manager.py''',
  '''backend/core/vbi_debug_tracer.py''',
  '''diagnose_voice_confidence.py''',
  '''diagnose_verification_failure.py''',
  '''diagnose_low_confidence.py''',
  '''fix_voice_profiles.py''',
  '''fix_voice_embedding_mismatch.py''',
  '''fix_profile_ownership.py''',
  '''regenerate_embedding_from_audio.py''',
  '''reconstruct_embedding.py''',
  '''verify_embedding_update.py''',
  # Test files can have mock secrets
  '''backend/tests/''',
  '''backend/*/tests/''',
  # GitHub Actions test scripts (mock/test data only)
  '''.github/workflows/scripts/''',
  # Documentation
  '''docs/''',
  '''wiki/''',
  '''Ironcliw-AI.wiki/''',
  # macOS Helper notification files (contain app names like "1Password", not secrets)
  '''backend/macos_helper/notification_monitor.py''',
  '''backend/macos_helper/intelligence/notification_triage.py''',
  # Postman collections (contain example API requests and user-facing messages, not actual secrets)
  '''postman/collections/''',
]

# Commits to skip (if you've already cleaned history)
commits = []

# Stop scanning at specific commits (if needed)
stopwords = []
