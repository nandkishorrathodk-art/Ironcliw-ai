# Ironcliw Voice Integration System

## Overview

The Ironcliw Voice Integration System provides comprehensive voice capabilities including automatic notifications, natural conversation, and voice-based approvals. The system is fully dynamic, using Anthropic's Claude API for natural language generation without hardcoded responses.

## Features

### 🔊 Voice Announcements (500-800 lines)
- **Automatic Notification Announcements**: Intelligently detects and announces notifications from any application
- **Dynamic Content Generation**: Uses Claude API to generate natural, contextual announcements
- **Urgency-based Prioritization**: Adjusts announcement priority based on content urgency
- **Smart Timing**: Respects quiet hours and user availability
- **Anti-spam Protection**: Prevents redundant announcements

### 🎤 Natural Voice Communication (300-500 lines)
- **Conversational Responses**: Natural, context-aware voice interactions
- **Voice Command Processing**: Interprets and responds to complex voice commands
- **Context Retention**: Maintains conversation history for coherent interactions
- **Confidence Handling**: Requests clarification for unclear voice input
- **Personality Adaptation**: Adjusts response style based on user preferences and context

### ✅ Voice-based Approval System
- **Action Approvals**: Voice confirmation for autonomous actions
- **Dynamic Approval Requests**: Natural language approval requests generated by Claude
- **Response Interpretation**: Understands various approval/denial phrases
- **Timeout Handling**: Graceful handling of approval timeouts
- **Context-aware Requests**: Provides relevant context for informed decisions

## Architecture

```
VoiceIntegrationSystem
├── VoiceAnnouncementSystem
│   ├── Announcement Queue Management
│   ├── Dynamic Content Generation (Claude API)
│   ├── Context-aware Delivery
│   └── Learning & Effectiveness Tracking
├── NaturalVoiceCommunication
│   ├── Conversation State Management
│   ├── Natural Response Generation (Claude API)
│   ├── Voice Command Processing
│   └── Approval Request Handling
└── Integration Components
    ├── Notification Intelligence
    ├── Autonomous Decision Engine
    ├── Workspace Monitor
    └── Context Engine
```

## Installation & Setup

### Prerequisites
```bash
# Install required Python packages
pip install anthropic
pip install asyncio
pip install speech-recognition
pip install pyttsx3
pip install edge-tts

# For macOS native voice (recommended)
# System requirements: macOS with built-in speech synthesis
```

### Environment Setup
```bash
# Set your Anthropic API key
export ANTHROPIC_API_KEY="your-claude-api-key-here"

# Optional: Configure voice preferences
export Ironcliw_VOICE_RATE="175"
export Ironcliw_VOICE_VOLUME="0.9"
```

## Usage

### Basic Integration

```python
from autonomy.voice_integration import VoiceIntegrationSystem

# Initialize system
voice_system = VoiceIntegrationSystem()

# Start voice integration
await voice_system.start_voice_integration()

# The system is now active and will:
# - Monitor for notifications to announce
# - Process voice commands naturally
# - Request approvals for autonomous actions
```

### Voice Announcements

```python
# Queue a notification announcement
announcement_id = await voice_system.announce_notification(
    notification=intelligent_notification,
    force=False  # Respects user context and timing
)

# Queue a custom announcement
await voice_system.announcement_system.queue_announcement(
    content="Custom announcement message",
    urgency=0.7,  # 0.0 to 1.0
    context="custom",
    requires_approval=False
)
```

### Natural Voice Communication

```python
# Process a voice command
response = await voice_system.process_voice_command(
    command="What's my schedule looking like today?",
    confidence=0.95
)

# Response will be generated dynamically by Claude
print(response)  # Natural, contextual response
```

### Voice-based Approvals

```python
from autonomy.autonomous_decision_engine import AutonomousAction, ActionPriority

# Create an action that needs approval
action = AutonomousAction(
    action_type="close_inactive_apps",
    target="system",
    params={"apps": ["Safari", "TextEdit"]},
    priority=ActionPriority.MEDIUM,
    confidence=0.6,  # Below threshold, triggers approval request
    category="system_optimization",
    reasoning="Close inactive applications to free up system resources"
)

# Request voice approval
approval = await voice_system.request_approval(
    action=action,
    timeout=30
)

if approval == ApprovalResponse.APPROVED:
    # Execute the action
    await decision_engine.execute_action(action)
```

## Configuration

### Voice Preferences

```python
# Customize announcement behavior
voice_system.announcement_system.user_preferences.update({
    'announcement_style': 'concise',  # concise, detailed, contextual
    'urgency_threshold': 0.7,         # 0.0 to 1.0
    'quiet_hours': (22, 7),          # 10 PM to 7 AM
    'preferred_voice_personality': VoicePersonality.CONTEXTUAL
})

# Customize approval thresholds
voice_system.voice_approval_threshold = 0.7  # Actions below this need approval
```

### Integration Settings

```python
# Enable/disable features
voice_system.auto_announce_notifications = True
voice_system.smart_interruption_detection = True

# Configure monitoring intervals
voice_system.notification_check_interval = 5    # seconds
voice_system.context_update_interval = 60      # seconds
```

## Advanced Features

### Context-Aware Responses

The system automatically adapts responses based on:
- **Time of day**: Morning, afternoon, evening contexts
- **User emotional state**: Detected through workspace analysis
- **Cognitive load**: Current work intensity and focus level
- **Recent interactions**: Conversation history and patterns
- **Environmental factors**: System state and notifications

### Dynamic Content Generation

All voice content is generated dynamically using Claude API:

```python
# Example: Announcement generation
prompt = f"""Generate a natural Ironcliw announcement for:
Context: {notification.context}
Content: {notification.content}
Urgency: {notification.urgency}
User state: {current_context}

Make it sound natural and appropriate for the context."""

# Claude generates contextual response
response = await claude.messages.create(...)
```

### Learning & Adaptation

The system continuously learns from interactions:
- **Effectiveness tracking**: Monitors announcement success rates
- **Pattern recognition**: Learns user preferences and response patterns
- **Context optimization**: Improves context understanding over time
- **Response refinement**: Enhances response quality based on feedback

## Integration with Ironcliw Components

### Notification Intelligence
```python
# Automatic integration with notification detection
from autonomy.notification_intelligence import NotificationIntelligence

notification_intel = NotificationIntelligence()
# Voice system automatically announces detected notifications
```

### Autonomous Decision Engine
```python
# Automatic approval requests for low-confidence actions
from autonomy.autonomous_decision_engine import AutonomousDecisionEngine

decision_engine = AutonomousDecisionEngine()
# Voice system handles approval requests automatically
```

### Workspace Monitor
```python
# Context-aware announcements based on workspace state
from vision.enhanced_monitoring import EnhancedWorkspaceMonitor

monitor = EnhancedWorkspaceMonitor()
# Voice system adapts to current workspace context
```

## Testing & Debugging

### Run the Demo
```bash
python demo_voice_integration.py
```

### Enable Debug Logging
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Check System Statistics
```python
stats = voice_system.get_voice_statistics()
print(f"Total interactions: {stats['total_interactions']}")
print(f"System active: {stats['system_active']}")
```

## API Reference

### VoiceIntegrationSystem

Main class that coordinates all voice functionality.

**Methods:**
- `start_voice_integration()`: Start the complete voice system
- `stop_voice_integration()`: Gracefully stop the voice system
- `announce_notification(notification)`: Announce a notification
- `process_voice_command(command, confidence)`: Process voice input
- `request_approval(action, timeout)`: Request voice approval
- `get_voice_statistics()`: Get system statistics

### VoiceAnnouncementSystem

Handles intelligent voice announcements.

**Methods:**
- `queue_announcement(content, urgency, context)`: Queue announcement
- `start_announcement_system()`: Start announcement processing
- `stop_announcement_system()`: Stop announcement processing

### NaturalVoiceCommunication

Manages conversational voice interactions.

**Methods:**
- `process_voice_command(command, confidence)`: Process voice input
- `request_voice_approval(request, context, timeout)`: Request approval
- `start_voice_communication()`: Start communication system

## Troubleshooting

### Common Issues

1. **No voice output**
   - Check audio system permissions
   - Verify TTS engine installation
   - Check volume settings

2. **Poor speech recognition**
   - Calibrate microphone
   - Reduce background noise
   - Check speech recognition confidence thresholds

3. **API errors**
   - Verify ANTHROPIC_API_KEY is set correctly
   - Check API rate limits
   - Ensure network connectivity

### Performance Optimization

- **Reduce API calls**: Adjust context update intervals
- **Optimize announcements**: Tune urgency thresholds
- **Memory management**: Monitor conversation history size

## Future Enhancements

- **Multi-language support**: Expand to additional languages
- **Voice biometrics**: User identification through voice
- **Emotion recognition**: Detect user emotional state from voice
- **Advanced context**: Integration with calendar, email, and other data sources
- **Custom wake words**: Personalized activation phrases

## Contributing

When contributing to the voice integration system:

1. **Maintain dynamic generation**: Avoid hardcoded responses
2. **Preserve context awareness**: Ensure new features consider user context
3. **Test thoroughly**: Voice interactions are critical for user experience
4. **Document clearly**: Voice features need clear documentation
5. **Consider accessibility**: Ensure features work for users with different needs

## License

This voice integration system is part of the Ironcliw AI Agent project and follows the same licensing terms.